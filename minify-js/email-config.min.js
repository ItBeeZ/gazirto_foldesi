function getEmailConfig(){if(window.SECURE_EMAIL_CONFIG)return window.SECURE_EMAIL_CONFIG;if("function"==typeof getSecureEmailConfig){const e=getSecureEmailConfig();if(e)return window.SECURE_EMAIL_CONFIG=e,e}throw new Error("EmailJS konfiguráció nem érhető el. Ellenőrizze a beállításokat.")}const TEMPLATE_PARAMS={from_name:"name",from_email:"email",phone:"phone",service:"service",message:"message",subject:"subject",time:"time",to_name:"Gázirtó Kertész",reply_to:"email"};let lastEmailSent=0;const EMAIL_COOLDOWN=6e4;let emailAttempts=0;const MAX_ATTEMPTS_PER_SESSION=3;function initializeEmailJS(){try{if("undefined"==typeof emailjs)throw new Error("EmailJS nincs betöltve");const e=getEmailConfig();if(!e)throw new Error("EmailJS konfiguráció nem érhető el");return emailjs.init({publicKey:e.publicKey,blockHeadless:!0,blockList:{list:["test@test.com","spam@spam.com","fake@fake.com"],watchVariable:"userEmail"},limitRate:{id:"gazirto_contact_form",throttle:3e4}}),console.log("EmailJS sikeresen inicializálva biztonságos konfigurációval"),!0}catch(e){return console.error("EmailJS inicializálási hiba:",e),!1}}async function sendEmailViaEmailJS(e){try{if(emailAttempts++,emailAttempts>3)throw new Error("Túl sok próbálkozás ebben a session-ben. Kérjük, frissítse az oldalt és próbálja újra.");const t=Date.now();if(t-lastEmailSent<6e4){const e=Math.ceil((6e4-(t-lastEmailSent))/1e3);throw new Error(`Túl sok kérés. Kérjük, várjon ${e} másodpercet.`)}if("undefined"==typeof emailjs)throw new Error("EmailJS nincs betöltve");const i=getEmailConfig();if(!i)throw new Error("EmailJS konfiguráció nem érhető el");const a={};if(Object.keys(TEMPLATE_PARAMS).forEach((t=>{const i=TEMPLATE_PARAMS[t];if("name"===i||"email"===i||"phone"===i||"service"===i||"message"===i){let s="";e instanceof FormData?s=e.get(i)||"":"object"==typeof e&&(s=e[i]||""),a[t]=s}else if("subject"===i){const i=e instanceof FormData?e.get("name")||"Ügyfél":e.name||"Ügyfél",s={gyomirtas:"Kertápolás","permetezés":"Permetezés",talajkezeles:"Talajkezelés",tanacsadas:"Tanácsadás",egyeb:"Egyéb szolgáltatás"}[e instanceof FormData?e.get("service")||"általános":e.service||"általános"]||"Általános megkeresés";a[t]=`Új ügyféli megkeresés - ${s} (${i})`}else a[t]="time"===i?(new Date).toLocaleString("hu-HU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):i})),!a.from_email||!a.from_name||!a.message)throw new Error("Kötelező mezők hiányoznak");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.from_email))throw new Error("Érvénytelen email formátum");console.log("Email küldése a következő paraméterekkel:",a);const s=await emailjs.send(i.serviceId,i.templateId,a);return lastEmailSent=t,console.log("Email sikeresen elküldve:",s),{success:!0,response:s}}catch(e){console.error("Email küldési hiba:",e);let t="Ismeretlen hiba történt";return e.text?t=e.text.includes("Invalid")||400===e.status?"Hibás adatok vagy konfiguráció":401===e.status||e.text.includes("Unauthorized")?"Hitelesítési hiba - ellenőrizze az EmailJS beállításokat":403===e.status?"Hozzáférés megtagadva":429===e.status||e.text.includes("rate")?"Túl sok kérés - próbálja újra később":e.text:e.message&&(t=e.message),{success:!1,error:t}}}window.getEmailConfig=getEmailConfig,window.initializeEmailJS=initializeEmailJS,window.sendEmailViaEmailJS=sendEmailViaEmailJS,console.log("EmailJS biztonságos konfiguráció betöltve. Érzékeny adatok nem tárolódnak a kódban.");